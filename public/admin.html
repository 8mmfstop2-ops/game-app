<!DOCTYPE html>
<html>
<head>
  <title>Admin Login</title>
  <style>
    .hidden { display: none; }
    button:disabled { background-color: #ccc; }
    pre {
      background: #f4f4f4;
      padding: 10px;
      border: 1px solid #ccc;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div id="login-screen">
    <h2>Admin Login</h2>
    <input type="text" id="username" placeholder="Username"><br>
    <input type="password" id="password" placeholder="Password"><br>
    <button onclick="login()">Login</button>
  </div>

  <!-- Admin Dashboard -->
  <div id="admin-dashboard" class="hidden">
    <h2>Admin Dashboard</h2>
    <button onclick="showRoomManagement()">Room Management</button>
    <button onclick="showCards()">Cards</button>
  </div>

  <!-- Room Management -->
  <div id="room-management" class="hidden">
    <h3>Create Room</h3>
    <input type="text" id="roomCode" placeholder="Room Code">
    <button onclick="createRoom()">Create</button>
    <br><br>
    <button onclick="loadRooms()">Refresh</button>
    <div id="room-list"></div>
  </div>

  <!-- Cards Management -->
  <div id="cards-page" class="hidden">
    <h3>Add New Question</h3>
    <input type="text" id="questionText" placeholder="Enter question">
    <button onclick="addQuestion()">Add</button>
    <br><br>
    <button onclick="loadQuestions()">Show Existing Questions</button>
    <div id="question-list"></div>
    <br><br>
    <h3>Delete Question</h3>
    <input type="text" id="deleteId" placeholder="Enter Question ID">
    <button onclick="deleteQuestion()">Delete</button>
  </div>

  <!-- SQL Setup Instructions -->
  <div id="sql-setup" class="hidden">
    <h3>Database Setup Instructions</h3>
    <p>Run these SQL commands in your Render Postgres database to create the tables:</p>
    <pre>
CREATE TABLE IF NOT EXISTS rooms (
  code TEXT PRIMARY KEY,
  status TEXT
);

CREATE TABLE IF NOT EXISTS questions (
  id SERIAL PRIMARY KEY,
  text TEXT
);
    </pre>
  </div>

<script>
function login() {
  const user = document.getElementById("username").value;
  const pass = document.getElementById("password").value;
  if (user === "game-admin" && pass === "Rainbow6GoldenEye") {
    document.getElementById("login-screen").classList.add("hidden");
    document.getElementById("admin-dashboard").classList.remove("hidden");
    document.getElementById("sql-setup").classList.remove("hidden");
  } else {
    alert("Invalid login");
  }
}

function showRoomManagement() {
  document.getElementById("admin-dashboard").classList.add("hidden");
  document.getElementById("room-management").classList.remove("hidden");
}

function showCards() {
  document.getElementById("admin-dashboard").classList.add("hidden");
  document.getElementById("cards-page").classList.remove("hidden");
}

async function createRoom() {
  const code = document.getElementById("roomCode").value;
  await fetch("/api/rooms", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ code: code, status: "Open" })
  });
  loadRooms();
}

async function loadRooms() {
  const res = await fetch("/api/rooms");
  const rooms = await res.json();
  const list = document.getElementById("room-list");
  list.innerHTML = "";
  rooms.forEach(r => {
    list.innerHTML += `
      <div>
        Room: ${r.code} | Status: ${r.status}
        <button onclick="updateRoom('${r.code}','Open')">Open</button>
        <button onclick="updateRoom('${r.code}','Closed')">Closed</button>
      </div>`;
  });
}

async function updateRoom(code, status) {
  await fetch("/api/rooms/" + code, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ status })
  });
  loadRooms();
}

async function addQuestion() {
  const text = document.getElementById("questionText").value;
  await fetch("/api/questions", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ text })
  });
  loadQuestions();
}

async function loadQuestions() {
  const res = await fetch("/api/questions");
  const questions = await res.json();
  const list = document.getElementById("question-list");
  list.innerHTML = "";
  questions.forEach(q => {
    list.innerHTML += `<div>ID: ${q.id} | Q: ${q.text}</div>`;
  });
}

async function deleteQuestion() {
  const id = document.getElementById("deleteId").value;
  await fetch("/api/questions/" + id, { method: "DELETE" });
  loadQuestions();
}
</script>
</body>
</html>
